# Documentation Automation and CI/CD Enhancement

## Background and description

The OpenTelemetry documentation website relies on various automated processes
for building, validating, and maintaining content. However, several manual
processes remain, and existing automation has limitations that cause maintenance
burden and occasional build failures.

This project aims to enhance documentation automation, improve CI/CD pipelines,
and implement systems for tracking documentation freshness and detecting
outdated content.

### Current challenges

The current documentation automation has several gaps:

- **Manual Collector metrics maintenance**: The list of Collector internal
  metrics on the website is manually maintained and can become out of sync with
  the actual metrics generated by `mdatagen`. This leads to incomplete or
  inaccurate documentation.
- **Version update automation issues**: The automated version update process for
  Collector releases can break builds when patch releases don't include all
  components (e.g., Collector Builder or Supervisor). The `cascade` field in
  Hugo front matter causes issues with partial releases.
- **No automated outdated content detection**: There's no systematic way to
  identify documentation that has become stale or needs updating. Content can
  remain outdated for extended periods without maintainer awareness.
- **Missing mdatagen integration**: The `mdatagen` tool generates documentation
  for Collector components, but this isn't integrated into the website
  documentation pipeline.
- **Limited pre-commit checks**: Contributors may submit PRs that fail CI checks
  because there are no local pre-commit hooks to catch common issues before
  pushing.

**Existing automation verified in repository (`scripts/`):**

```
scripts/
├── auto-update/           # Version update scripts
│   ├── all-versions.sh    # Updates all component versions
│   └── version-in-file.sh # Updates versions in specific files
├── git/
│   └── pre-commit.sh      # Basic pre-commit (only runs `npm run fix:format:staged`)
├── _md-rules/             # Markdown validation rules
│   ├── trim-code-blank-lines.js
│   ├── unindent-code-blocks.js
│   └── validate-links.js
├── check-build-log.sh     # Build log validation
├── check-i18n.sh          # Localization drift detection
├── check-registry-urls    # Registry URL validation
├── registry-scanner/      # Registry scanning tools
├── stats/                 # Documentation statistics
└── content-modules/       # Content module processing
```

**Gap analysis:**

- ✅ Version update scripts exist but have issues with patch releases
- ⚠️ Pre-commit hook exists but is minimal (only formatting)
- ⚠️ Markdown rules exist but not integrated with pre-commit
- ❌ No mdatagen integration
- ❌ No automated freshness tracking
- ❌ No husky setup for comprehensive pre-commit hooks

If these challenges are not addressed:

- Documentation will continue to drift from actual software behavior.
- Maintainers will spend excessive time on manual updates and build fixes.
- Users will encounter inaccurate or outdated information.
- Contributor experience will suffer from slow feedback loops.

### Goals, objectives, and requirements

The goal of this project is to:

1. **Automate Collector metrics documentation**: Integrate mdatagen output into
   the website.
2. **Fix version update automation**: Handle patch releases correctly without
   breaking builds.
3. **Detect outdated content**: Implement systems to identify stale
   documentation.
4. **Improve contributor experience**: Add pre-commit hooks and local validation
   tools.
5. **Track documentation freshness**: Create visibility into documentation age
   and update needs.

**Motivations for starting now**:

- The Collector documentation refactoring project (sig:collector:refactor) would
  benefit from automated tooling.
- Recent build failures from patch releases highlight the urgency of fixing
  version automation.
- Community feedback indicates that outdated content is a significant problem.

## Deliverables

### mdatagen integration

- **Automated metrics documentation**: Pipeline to extract and publish Collector
  component metrics from mdatagen.
- **Component documentation sync**: Automated sync of component READMEs to
  website.
- **Stability level tracking**: Automated tracking and display of component
  stability levels.

### Version automation improvements

- **Patch release handling**: Fix the cascade version update mechanism to handle
  partial releases.
- **Component-specific versioning**: Separate version tracking for Collector
  core, contrib, Builder, and Supervisor.
- **Release notes integration**: Automated linking to release notes for each
  version.

### Outdated content detection

- **Content age tracking**: System to track when content was last updated.
- **Drift detection alerts**: Automated notifications when content hasn't been
  updated within a threshold.
- **External link validation**: Regular checks for broken external links.
- **API/SDK version comparisons**: Alerts when documented versions fall behind
  latest releases.

### Contributor tooling

- **Pre-commit hooks**: Using [husky](https://github.com/typicode/husky) for:
  - Markdown linting.
  - Spell checking.
  - Format validation.
  - Link checking (local).
- **Local validation scripts**: Easy-to-run scripts for common validation tasks.
- **Documentation**: Guide for setting up and using local tooling.

### Freshness tracking

- **Documentation freshness dashboard**: Visibility into documentation age
  across sections.
- **Update priority scoring**: System to prioritize which content needs updates
  most urgently.
- **Maintainer notifications**: Automated notifications for high-priority
  updates.

## Timeline

- **Month 1**: Audit current automation, document requirements.
- **Month 2**: Implement pre-commit hooks and local tooling.
- **Month 3**: Fix version update automation for patch releases.
- **Month 4**: Implement mdatagen integration for Collector metrics.
- **Month 5**: Build content freshness tracking system.
- **Month 6**: Testing, documentation, and rollout.

## Labels

- `docs:CI/infra`
- `sig:comms`
- `sig:collector`

## Related issues

- [#4523 - Automate the Collector list of internal metrics using `mdatagen` docs](https://github.com/open-telemetry/opentelemetry.io/issues/4523)
  (open) - mdatagen integration for metrics documentation.
- [#7546 - Collector patch release updates break build because not all components are included](https://github.com/open-telemetry/opentelemetry.io/issues/7546)
  (open) - Version automation issues.
- [#8313 - Set up git pre-commit and other hooks to make for a smoother contributor experience](https://github.com/open-telemetry/opentelemetry.io/issues/8313)
  (open) - Pre-commit hooks using husky.

## Project Board

To be created upon project approval.

## SIG Meetings and Other Info

This project will be coordinated through SIG Communications meetings with input
from SIG Collector.

- **Slack channel**: `#otel-comms`
- **Meeting notes**: To be linked upon project start.
