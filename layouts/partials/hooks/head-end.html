{{ with .Params.canonical_url -}}

<link rel="canonical" href="{{ . }}">

{{- else -}}

  {{ $canonicalURL := .Permalink -}}

  {{ $defaultLang := "en" -}}
  {{ if and (ne .Language.Lang $defaultLang) .File -}}
    {{/* This page is in a non-default-language section */ -}}
    {{ $pagePath := strings.TrimPrefix (add hugo.WorkingDir "/content/") .File.Filename -}}
    {{ if hasPrefix $pagePath $defaultLang -}}

      {{/* This page is actually a default-language fallback page. Use the link
      to the origin of the fallback page as canonical reference. */ -}}

      {{ $translationPages := where .Translations "Lang" $defaultLang -}}
      {{ $translation := index $translationPages 0 -}}
      {{ with $translation -}}
        {{ $canonicalURL = .Permalink -}}
      {{ end -}}
    {{ end -}}
  {{ end -}}
  <link rel="canonical" href="{{ $canonicalURL }}" data-proofer-ignore>

{{- end -}}

<!-- Kapa.ai Chat Widget -->
<script 
  async 
  src="https://widget.kapa.ai/kapa-widget.bundle.js" 
  data-website-id="2b645d39-e001-4c2b-bfbd-aa4f25453385"
  data-project-name="OpenTelemetry"
  data-project-color="#f5a800"
  data-project-logo="https://opentelemetry.io/img/logos/opentelemetry-logo-nav.png"
  data-button-hide="true"
  data-modal-override-open-id="kapa-ai-trigger"
  data-modal-border-radius="8px"
  data-modal-header-bg-color="#4f62ad"
  data-modal-title="OpenTelemetry Docs AI"
  data-modal-title-color="#ffffff"
  data-modal-body-bg-color="#ffffff"
  data-query-input-border-color="#f5a800"
  data-modal-disclaimer="This is an experimental feature that uses AI to answer questions using the documentation, OpenTelemetry GitHub, StackOverflow, and other resources. Please give us feedback in [this GitHub issue](https://github.com/open-telemetry/opentelemetry.io/issues/6658)."
  data-font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif">
</script>