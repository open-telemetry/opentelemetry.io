---
title: মেমরি লিক নির্ণয়ে মেট্রিকস ও ট্রেস ব্যবহারের উপায়
linkTitle: মেমরি লিক নির্ণয়
aliases:
  - ../scenarios/recommendation-cache/
  - ../scenarios/recommendation_cache
default_lang_commit: 2571ec5a1e17744982e8dc6efe1fdf3115d0ebbc
---

অ্যাপ্লিকেশন টেলিমেট্রি, যেমন OpenTelemetry যা সরবরাহ করতে পারে, একটি বিতরণকৃত সিস্টেমে সমস্যা নির্ণয়ের জন্য অত্যন্ত উপযোগী। এই পরিস্থিতিতে, আমরা একটি দৃশ্যের মধ্য দিয়ে হাঁটব যা দেখাবে কীভাবে উচ্চ-স্তরের মেট্রিকস এবং ট্রেস ব্যবহার করে একটি মেমরি লিকের কারণ নির্ধারণ করা যায়।

## সেটআপ

এই দৃশ্য চালাতে, আপনাকে ডেমো অ্যাপ্লিকেশনটি ডিপ্লয় করতে হবে এবং `recommendationServiceCacheFailure` ফিচার ফ্ল্যাগ সক্রিয় করতে হবে। ফিচার ফ্ল্যাগ চালু করার পরে অ্যাপ্লিকেশনটিকে প্রায় ১০ মিনিট চালাতে দিন যাতে পর্যাপ্ত পরিমাণ ডেটা সংগ্রহ হয়।

## নির্ণয়

সমস্যা নির্ণয়ের প্রথম ধাপ হল জানা যে কোন সমস্যা ঘটছে। প্রায়শই প্রথম নজরে পড়ে একটি মেট্রিকস ড্যাশবোর্ড, যেমন Grafana সরবরাহ করে।

একটি [ডেমো ড্যাশবোর্ড ফোল্ডার](http://localhost:8080/grafana/dashboards) থাকা উচিত ডেমো চালু করার পরে, যেখানে দুটি ড্যাশবোর্ড থাকবে; একটি OpenTelemetry Collector মনিটর করার জন্য, আরেকটি বিভিন্ন কোয়েরি ও চার্ট সহ সার্ভিসের লেটেন্সি ও অনুরোধ হার বিশ্লেষণের জন্য।

![Grafana dashboard](grafana-dashboard.png)

এই ড্যাশবোর্ডে অনেক চার্ট থাকবে, তবে কিছু গুরুত্বপূর্ণভাবে নজর কাড়বে:

- রেকমেন্ডেশন সার্ভিস (CPU% এবং মেমরি)
- সার্ভিস লেটেন্সি (SpanMetrics থেকে)
- ত্রুটি হার (Error Rate)

রেকমেন্ডেশন সার্ভিস চার্টগুলো OpenTelemetry মেট্রিকস থেকে প্রোমিথিয়াসে এক্সপোর্ট করা হয়েছে, এবং সার্ভিস লেটেন্সি ও ত্রুটি হার চার্টগুলো OpenTelemetry Collector-এর Span Metrics প্রসেসরের মাধ্যমে তৈরি হয়েছে।

আমাদের ড্যাশবোর্ডে দেখা যাচ্ছে যে রেকমেন্ডেশন সার্ভিসে অস্বাভাবিক আচরণ রয়েছে — CPU ব্যবহারে হঠাৎ উঁচু স্পাইক, এবং p95, 99, ও 99.9 হিস্টোগ্রামে দীর্ঘ লেজ বিশিষ্ট লেটেন্সি। আমরা মাঝে মাঝে মেমরি ব্যবহারের স্পাইকও দেখতে পাচ্ছি।

আমরা জানি যে আমাদের অ্যাপ্লিকেশন থেকে ট্রেস ডেটাও পাঠানো হচ্ছে, তাই চলুন ভাবি অন্যভাবে কিভাবে এই সমস্যাটি শনাক্ত করা যায়।

![Jaeger](jaeger.png)

Jaeger আমাদের ট্রেস খুঁজতে ও সম্পূর্ণ অনুরোধের প্রান্ত-থেকে-প্রান্ত লেটেন্সি দেখতে সাহায্য করে, প্রতিটি অংশের ভিতরে দৃশ্যমানতা প্রদান করে। ধরুন আমরা আমাদের ফ্রন্টএন্ড অনুরোধে লেটেন্সি বেড়ে গেছে লক্ষ্য করেছি। Jaeger আমাদের ট্রেস ফিল্টার করতে দেয় যেন আমরা শুধু সেই অনুরোধগুলো দেখি যেগুলো রেকমেন্ডেশন সার্ভিসে যায়।

লেটেন্সি অনুযায়ী সাজালে আমরা দ্রুত দীর্ঘ সময় নেওয়া ট্রেসগুলো খুঁজে পেতে পারি। ডান পাশের প্যানেলে ট্রেসে ক্লিক করে আমরা ওয়াটারফল ভিউ দেখতে পারি।

![Jaeger waterfall](jaeger-waterfall.png)

এখানে দেখা যায় যে রেকমেন্ডেশন সার্ভিসটি কাজ শেষ করতে অনেক সময় নিচ্ছে, এবং বিশদে দেখলে আরও ভালো বোঝা যায় কী ঘটছে।

## নির্ণয় নিশ্চিতকরণ

আমরা ওয়াটারফল ভিউতে দেখতে পাচ্ছি যে `app.cache_hit` অ্যাট্রিবিউটটি false সেট করা আছে, এবং `app.products.count` মানটি অত্যন্ত বেশি।

অনুসন্ধান UI-তে ফিরে গিয়ে, Service ড্রপডাউন থেকে `recommendation` নির্বাচন করুন, এবং Tags বক্সে `app.cache_hit=true` দিয়ে অনুসন্ধান করুন। লক্ষ্য করুন যে যখন ক্যাশ হিট হয়, তখন অনুরোধগুলো দ্রুত হয়। এখন `app.cache_hit=false` দিয়ে অনুসন্ধান করুন এবং লেটেন্সি তুলনা করুন। আপনি দেখতে পাবেন যে ট্রেস তালিকার উপরের ভিজ্যুয়ালাইজেশনে কিছু পরিবর্তন হয়েছে।

এখন, যেহেতু এটি একটি কৃত্রিম দৃশ্য, আমরা জানি কোথায় বাগ রয়েছে। তবে বাস্তব জগতে, আমাদের কোডে বা সার্ভিসগুলোর পারস্পরিক ক্রিয়ায় আরও গভীর অনুসন্ধান করতে হতে পারে।

