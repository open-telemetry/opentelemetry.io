---
title: Sampling
weight: 80
---

[Sampling](/docs/concepts/sampling/) is a process that restricts the amount of
spans that are generated by a system. The exact sampler you should use depends
on your specific needs, but in general you should make a decision at the start
of a trace, and allow the sampling decision to propagate to other services.

A [`Sampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#Sampler) can
be set on the tracer provider using the
[`WithSampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#WithSampler)
option, as follows:

```go
provider := trace.NewTracerProvider(
    trace.WithSampler(trace.AlwaysSample()),
)
```

## Built-in Samplers

[`AlwaysSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#AlwaysSample)
and
[`NeverSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#NeverSample)
are self-explanatory values. `AlwaysSample` means that every span is sampled,
while `NeverSample` means that no span is sampled. When you're getting started,
or in a development environment, use `AlwaysSample`.

Other samplers include:

- [`TraceIDRatioBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#TraceIDRatioBased),
  which samples a fraction of spans, based on the fraction given to the sampler.
  If you set .5, half of all the spans are sampled.
- [`ParentBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#ParentBased),
  is a sampler decorator which behaves differently, based on the parent of the
  span. If the span has no parent, the decorated sampler is used to make
  sampling decision based on the parent of the span. By default, `ParentBased`
  samples spans that have parents that were sampled, and doesn't sample spans
  whose parents were not sampled.

By default, the tracer provider uses a `ParentBased` sampler with the
`AlwaysSample` sampler.

When in a production environment, consider using the `ParentBased` sampler with
the `TraceIDRatioBased` sampler.

## Custom Samplers

You can also create custom samplers by implementing the
[`Sampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#Sampler)
interface. This allows you to define your own sampling logic based on your
specific requirements.

To create a custom sampler, you need to implement the `ShouldSample` method
which takes a `SamplingParameters` struct and returns a `SamplingResult`:

```go
type Sampler interface {
    ShouldSample(parameters SamplingParameters) SamplingResult
    Description() string
}
```

Here's an example of a custom sampler that samples spans based on an attribute value:

```go
package sampler

import (
  "go.opentelemetry.io/otel/attribute"
  sdktrace "go.opentelemetry.io/otel/sdk/trace"
  "go.opentelemetry.io/otel/trace"
)

// CustomSampler is a sampler that samples spans based on a specific attribute name and value.
type CustomSampler struct {
  attributeName  string
  attributeValue string
}

// NewCustomSampler creates a new CustomSampler with the specified attribute name and value.
func NewCustomSampler(attributeName, attributeValue string) *CustomSampler {
  return &CustomSampler{
    attributeName:  attributeName,
    attributeValue: attributeValue,
  }
}

// ShouldSample implements the sdktrace.Sampler interface.
func (s *CustomSampler) ShouldSample(p sdktrace.SamplingParameters) sdktrace.SamplingResult {
  // Check if the span has the specified attribute with the specified value
  for _, attr := range p.Attributes {
    if string(attr.Key) == s.attributeName && attr.Value.AsString() == s.attributeValue {
      return sdktrace.SamplingResult{
        Decision:   sdktrace.RecordAndSample,
        Attributes: []attribute.KeyValue{},
        Tracestate: trace.SpanContextFromContext(p.ParentContext).TraceState(),
      }
    }
  }

  // For spans that don't match our criteria, don't sample them
  return sdktrace.SamplingResult{
    Decision:   sdktrace.Drop,
    Attributes: []attribute.KeyValue{},
    Tracestate: trace.SpanContextFromContext(p.ParentContext).TraceState(),
  }
}

// Description returns the description of the sampler.
func (s *CustomSampler) Description() string {
  return "CustomSampler"
}
```

In this example, the custom sampler will sample spans that have an attribute
named "environment" with the value "production", otherwise spans is dropped.

This approach gives you full control over the sampling decision logic.